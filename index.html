<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Buddy - Your Cooking Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-3xl shadow-xl p-6 mb-6 border border-purple-100">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg text-2xl">
                        üë®‚Äçüç≥
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Kitchen Buddy</h1>
                        <p class="text-sm text-gray-600">Your cheerful cooking companion</p>
                    </div>
                </div>
                <button onclick="loadSampleRecipe()" class="flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl hover:shadow-lg transition-all font-medium">
                    üì§ Try Sample Recipe
                </button>
            </div>
            
            <!-- Always-on mic option -->
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-200">
                <label class="flex items-start gap-3 cursor-pointer">
                    <input type="checkbox" id="alwaysListening" class="mt-1 w-5 h-5 text-purple-600 rounded focus:ring-purple-500">
                    <div class="flex-1">
                        <p class="font-medium text-gray-800">Enable hands-free mode üé§</p>
                        <p class="text-sm text-gray-600 mt-1">
                            To make sure you don't get sauce all over your device, we can keep your mic on throughout the cooking process. Just say "Hey Chef" before your command!
                        </p>
                    </div>
                </label>
            </div>
        </div>

        <!-- Assistant Message -->
        <div class="bg-white rounded-3xl shadow-xl p-6 mb-6 border border-pink-100">
            <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-purple-500 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-md text-xl">
                    ‚ú®
                </div>
                <div class="flex-1">
                    <p class="text-gray-800 text-lg leading-relaxed" id="assistantMessage">
                        Hey there, chef! üëã Ready to cook something amazing? Just click "Try Sample Recipe" and I'll be your personal kitchen buddy!
                    </p>
                </div>
            </div>
        </div>

        <!-- Recipe Progress (Hidden Initially) -->
        <div id="recipeSection" style="display: none;">
            <div class="bg-white rounded-3xl shadow-xl p-6 mb-6 border border-orange-100">
                <h2 class="text-2xl font-bold mb-4">
                    Roasted Chicken with Root Vegetables
                    <span class="text-sm font-normal text-gray-600">(4 servings)</span>
                </h2>
                
                <!-- Progress Bar -->
                <div class="mb-6">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span class="font-medium">Step <span id="currentStep">1</span> of 7</span>
                        <span class="font-medium"><span id="progress">14</span>% Complete</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div id="progressBar" class="bg-gradient-to-r from-purple-400 via-pink-400 to-orange-400 h-4 rounded-full transition-all duration-700" style="width: 14%"></div>
                    </div>
                </div>

                <!-- Current Step -->
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-5 mb-4 border border-purple-200">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 text-white rounded-xl flex items-center justify-center font-bold text-lg shadow-md" id="stepNumber">1</div>
                        <h3 class="font-bold text-lg text-gray-800">Current Step</h3>
                    </div>
                    <p class="text-gray-700 ml-13 text-lg leading-relaxed" id="stepText"></p>
                    <div id="tipBox" class="ml-13 mt-3 p-3 bg-yellow-50 rounded-xl border border-yellow-200" style="display: none;">
                        <p class="text-sm text-yellow-800">üí° <span id="tipText"></span></p>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="flex gap-3">
                    <button onclick="previousStep()" class="px-5 py-3 bg-gray-100 text-gray-600 rounded-xl hover:bg-gray-200 transition font-medium">Previous</button>
                    <button onclick="nextStep()" class="flex-1 px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl hover:shadow-lg transition-all font-medium">
                        <span id="nextBtnText">Next Step</span> ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <!-- Active Timers (Hidden Initially) -->
        <div id="timersSection" style="display: none;">
            <div class="bg-white rounded-3xl shadow-xl p-6 mb-6 border border-blue-100">
                <h3 class="text-lg font-bold mb-4">‚è∞ Active Timers</h3>
                <div id="timersList" class="space-y-3"></div>
            </div>
        </div>

        <!-- Voice Control -->
        <div class="bg-white rounded-3xl shadow-xl p-6 border border-purple-100">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h3 class="text-lg font-bold mb-1">Voice Assistant</h3>
                    <p class="text-sm text-gray-600">Click the mic or say "Hey Chef" in hands-free mode!</p>
                </div>
                <button onclick="toggleListening()" id="micBtn" class="p-4 rounded-2xl transition-all shadow-lg bg-gradient-to-r from-purple-500 to-pink-500 hover:shadow-xl text-2xl">
                    üé§
                </button>
            </div>
            
            <div id="listeningIndicator" style="display: none;" class="p-3 bg-green-50 rounded-xl border border-green-200 flex items-center gap-2">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <p class="text-sm text-green-700">Listening for "Hey Chef" commands...</p>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentStepIndex = 0;
        let isListening = false;
        let alwaysListening = false;
        let recipeLoaded = false;
        let awaitingReady = false;
        let recognition = null;
        let timers = [];

        // Recipe
        const recipe = {
            steps: [
                {
                    instruction: "dice one large yellow onion into roughly 1/2 inch pieces",
                    detailed: "Take your large yellow onion and cut off both ends. Peel off the papery outer skin. Cut the onion in half from top to bottom. Place each half flat-side down, make horizontal cuts parallel to the cutting board (but don't cut all the way through), then make vertical cuts from top to bottom, and finally cut across to create dice.",
                    tips: "Pro tip: Keep the root end intact while cutting - it holds the onion together and makes dicing way easier!"
                },
                {
                    instruction: "peel and chop your 3 carrots and 2 potatoes into 1-inch chunks",
                    detailed: "Using a vegetable peeler, peel all 3 carrots and 2 potatoes. For the carrots, cut them into rounds about 1 inch thick. For the potatoes, cut them in half lengthwise, then cut each half into 3-4 chunks.",
                    tips: "Keeping vegetables the same size is key for even cooking!"
                },
                {
                    instruction: "season your whole chicken inside and out",
                    detailed: "Pat the chicken completely dry with paper towels - this is crucial for crispy skin! Sprinkle salt inside the cavity of the chicken. Then season the outside all over with salt, pepper, and dried herbs.",
                    tips: "Dry chicken = crispy skin! Take your time with this step."
                },
                {
                    instruction: "heat 2 tablespoons of olive oil in a large oven-safe skillet",
                    detailed: "Place your oven-safe skillet on the stove over medium-high heat. Add 2 tablespoons of olive oil and swirl it around. The oil is ready when it shimmers - about 2-3 minutes.",
                    tips: "If the oil starts smoking, it's too hot!"
                },
                {
                    instruction: "brown the seasoned chicken on all sides",
                    detailed: "Carefully place the chicken breast-side down in the hot oil. Let it sizzle for 4-5 minutes until golden. Using tongs, flip to brown the back, then turn breast-side up.",
                    tips: "Don't move the chicken too early! Let it get that golden crust.",
                    time: 10
                },
                {
                    instruction: "arrange vegetables around the chicken and put in the oven at 425¬∞F",
                    detailed: "Scatter your chopped vegetables around the chicken. Drizzle with oil and toss. Slide into your preheated 425¬∞F oven.",
                    tips: "Vegetables on the bottom get extra flavorful from the drippings!",
                    time: 45
                },
                {
                    instruction: "let the chicken rest before carving",
                    detailed: "Remove from oven (use mitts!). Transfer chicken to a cutting board and tent with foil. Let rest 10 minutes.",
                    tips: "Resting is the secret to juicy chicken!",
                    time: 10
                }
            ]
        };

        // Speech
        function speak(text) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.95;
                speechSynthesis.speak(utterance);
            }
        }

        // Load Recipe
        function loadSampleRecipe() {
            recipeLoaded = true;
            awaitingReady = true;
            document.getElementById('recipeSection').style.display = 'block';
            updateDisplay();
            
            const message = "Awesome! üéâ We're making Roasted Chicken with Root Vegetables! This serves 4 people and takes about 45 minutes. When you're ready to start cooking, just say 'Hey Chef, ready' or click the mic and say 'ready'!";
            
            document.getElementById('assistantMessage').textContent = message;
            speak(message);
            
            // Start listening if hands-free enabled
            const checkbox = document.getElementById('alwaysListening');
            if (checkbox.checked) {
                alwaysListening = true;
                startListening();
            }
        }

        // Voice Recognition
        function startListening() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = alwaysListening;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    isListening = true;
                    document.getElementById('micBtn').classList.add('animate-pulse');
                    if (alwaysListening) {
                        document.getElementById('listeningIndicator').style.display = 'flex';
                    }
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[event.results.length - 1][0].transcript;
                    handleCommand(transcript);
                };
                
                recognition.onend = () => {
                    if (alwaysListening && recipeLoaded) {
                        recognition.start(); // Restart for continuous
                    } else {
                        isListening = false;
                        document.getElementById('micBtn').classList.remove('animate-pulse');
                    }
                };
                
                recognition.start();
            }
        }

        function toggleListening() {
            if (isListening && !alwaysListening) {
                recognition.stop();
                isListening = false;
            } else {
                startListening();
            }
        }

        // Handle Commands
        function handleCommand(transcript) {
            const command = transcript.toLowerCase();
            console.log('Heard:', command);
            
            // Check for wake word in hands-free mode
            if (alwaysListening && !command.includes('chef')) {
                return; // Ignore without wake word
            }
            
            // Process commands
            if (awaitingReady && command.includes('ready')) {
                awaitingReady = false;
                announceStep(0);
            } else if (command.includes('next') || command.includes('done')) {
                nextStep();
            } else if (command.includes('repeat')) {
                announceStep(currentStepIndex);
            } else if (command.includes('previous') || command.includes('back')) {
                previousStep();
            }
        }

        // Step Management
        function announceStep(index) {
            const step = recipe.steps[index];
            const stepNum = index + 1;
            let message = `Step ${stepNum}: Let's ${step.instruction}. ${step.detailed} ${step.tips}`;
            
            // Add timer info if this step has one
            if (step.time) {
                message += ` This will take ${step.time} minutes. I'll set a timer for you!`;
                // Set timer after a short delay
                setTimeout(() => startTimer(step.instruction, step.time), 3000);
            }
            
            speak(message);
            document.getElementById('assistantMessage').textContent = `Step ${stepNum}: ${step.instruction}`;
        }

        function nextStep() {
            if (awaitingReady) {
                awaitingReady = false;
                announceStep(0);
                return;
            }
            
            if (currentStepIndex < recipe.steps.length - 1) {
                currentStepIndex++;
                updateDisplay();
                announceStep(currentStepIndex);
            } else {
                const message = "üéä You did it! Your delicious meal is ready. Enjoy!";
                speak(message);
                document.getElementById('assistantMessage').textContent = message;
            }
        }

        function previousStep() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                updateDisplay();
                announceStep(currentStepIndex);
            }
        }

        // Update UI
        function updateDisplay() {
            const step = recipe.steps[currentStepIndex];
            document.getElementById('currentStep').textContent = currentStepIndex + 1;
            document.getElementById('stepNumber').textContent = currentStepIndex + 1;
            document.getElementById('stepText').textContent = step.detailed;
            
            if (step.tips) {
                document.getElementById('tipBox').style.display = 'block';
                document.getElementById('tipText').textContent = step.tips;
            } else {
                document.getElementById('tipBox').style.display = 'none';
            }
            
            const progress = Math.round(((currentStepIndex + 1) / recipe.steps.length) * 100);
            document.getElementById('progress').textContent = progress;
            document.getElementById('progressBar').style.width = progress + '%';
            
            document.getElementById('nextBtnText').textContent = 
                currentStepIndex === recipe.steps.length - 1 ? "Finish!" : "Next Step";
        }

        // Timer Functions
        function startTimer(name, minutes) {
            const timer = {
                id: Date.now(),
                name: name.substring(0, 30),
                duration: minutes * 60,
                remaining: minutes * 60
            };
            timers.push(timer);
            document.getElementById('timersSection').style.display = 'block';
            
            const message = `Timer set! I'll let you know when your ${minutes} minutes are up.`;
            speak(message);
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const list = document.getElementById('timersList');
            list.innerHTML = timers.map(timer => `
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 flex items-center justify-between border border-blue-200">
                    <span class="font-semibold text-gray-700">${timer.name}</span>
                    <span class="text-2xl font-mono font-bold text-blue-600">
                        ${Math.floor(timer.remaining / 60)}:${(timer.remaining % 60).toString().padStart(2, '0')}
                    </span>
                </div>
            `).join('');
        }

        // Timer countdown
        setInterval(() => {
            let activeTimers = false;
            timers = timers.map(timer => {
                if (timer.remaining > 0) {
                    timer.remaining--;
                    activeTimers = true;
                    
                    // Alert when timer completes
                    if (timer.remaining === 0) {
                        const message = `üéâ Ding ding! Your ${timer.name} timer is done!`;
                        speak(message);
                        document.getElementById('assistantMessage').textContent = message;
                    }
                }
                return timer;
            }).filter(timer => timer.remaining > 0);
            
            if (activeTimers) {
                updateTimerDisplay();
            } else if (timers.length === 0) {
                document.getElementById('timersSection').style.display = 'none';
            }
        }, 1000);

        // Checkbox handler
        document.getElementById('alwaysListening').addEventListener('change', (e) => {
            alwaysListening = e.target.checked;
            if (alwaysListening && recipeLoaded) {
                startListening();
            } else if (!alwaysListening && recognition) {
                recognition.stop();
                document.getElementById('listeningIndicator').style.display = 'none';
            }
        });
    </script>
</body>
</html>
